<?php
/**
 Hyvä Themes - https://hyva.io
 Copyright © Hyvä Themes 2022-present. All rights reserved.
 This product is licensed per Magento install
 See https://hyva.io/license
/

/** @var \Magento\Payment\Block\Transparent\Iframe $block */
/** @var \Magento\Framework\View\Helper\SecureHtmlRenderer $secureRenderer */
/** @var \Magento\Payment\Block\Transparent\Iframe $block */

$params = $block->getParams();
?>
<html>
<head>
    <?php $scriptString = '' ?>
    <?php if (isset($params['redirect'])): ?>
        <?php $scriptString .= <<<script
            window.location="{$block->escapeJs($params['redirect'])}";
script;
        ?>
    <?php elseif (isset($params['redirect_parent'])): ?>
        <?php $scriptString .= <<<script
            var parentWindow = window.parent;

            parentWindow.dispatchEvent(new Event('magewire:loader:done'));
            parentWindow.location="{$block->escapeJs($params['redirect_parent'])}";   
script;
        ?>
    <?php elseif (isset($params['error_msg'])): ?>
        <?php
        $encodedMsg = /* @noEscape */ json_encode($params['error_msg']);
        $scriptString .= <<<script
            var parentWindow = window.parent;
            
            parentWindow.dispatchEvent(new Event('magewire:loader:done'));
            
            parentWindow.dispatchMessages([
                {
                    type: "error",
                    text: {$encodedMsg}
                }
            ]);
script;
        ?>
    <?php elseif (isset($params['order_success'])): ?>
        <?php $scriptString .= <<<script
            window.parent.location = "{$block->escapeJs($params['order_success'])}";
script;
        ?>
    <?php else: ?>
        <?php $scriptString .= <<<script
            window.parent.dispatchEvent(new Event('magewire:loader:done'));
script;
        ?>
    <?php endif; ?>
    <?= /* @noEscape */ $secureRenderer->renderTag('script', [], $scriptString, false) ?>
</head>
<body></body>
</html>
