<?php
/**
 * Hyvä Themes - https://hyva.io
 * Copyright © Hyvä Themes 2022-present. All rights reserved.
 * This product is licensed per Magento install
 * See https://hyva.io/license
 */

declare(strict_types=1);

use Hyva\Checkout\Magewire\Checkout\CustomerComment;
use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Framework\Escaper;

/** @var ViewModelRegistry $viewModels */
/** @var Escaper $escaper */
/** @var  CustomerComment $magewire */

$viewModel = $viewModels->require(Hyva\Checkout\ViewModel\Checkout\CustomerComment::class);
?>
<div class="border-t border-slate-300 pt-4">
    <div x-data="hyvaCheckoutCustomerComment"
         x-init="initialize"
         data-limit="250"
    >
        <div class="flex justify-between font-medium">
            <label class="block text-sm text-slate-700 mb-3" for="order-comment">
                <?= $escaper->escapeHtml(__('Order Comment')) ?> (<?= /* @noEscape */ mb_strtolower($escaper->escapeHtml(__('Optional'), 'UTF-8')) ?>)
            </label>

            <div class="text-green-500 space-x-4 text-sm">
                <span class="hidden"
                      wire:loading
                      wire:target="comment"
                      wire:loading.class.remove="hidden"
                >
                    ...<?= $escaper->escapeHtml(__('saving')) ?>
                </span>

                <?php if ($magewire->saved): ?>
                    <span wire:target="comment" class="flex"
                          wire:loading.class="hidden"
                    >
                        <?= $escaper->escapeHtml(__('saved successfully')) ?>
                    </span>
                <?php endif ?>
            </div>
        </div>

        <textarea id="order-comment"
                  wire:model.delay.750ms="comment"
                  x-bind:maxlength="limit"
                  type="text"
                  x-bind:value="content"
                  x-on:input="setContent"
                  rows="4"
                  class="block w-full
                         shadow-sm
                         border-gray-300 rounded-md
                         resize-y"
                  <?php if ($viewModel->hasPlaceholderText()): ?>
                  placeholder="<?= $escaper->escapeHtmlAttr($viewModel->getPlaceholderText()) ?>"
                  <?php endif ?>
        ></textarea>

        <div class="w-full flex flex-row-reverse mt-1 font" x-ref="remaining" x-cloak>
            <span x-text="getRemainingText"
                  x-show="showRemainingText"
                  x-bind:class="getRemainingTextClasses"
            ></span>

            <div x-ref="remaining">
                <p class="text-red-700" x-show="showRemainingLimitReached">
                    <?= $escaper->escapeHtml(__('You\'ve reached the maximum amount of characters')) ?>
                </p>
            </div>
        </div>
    </div>
</div>
