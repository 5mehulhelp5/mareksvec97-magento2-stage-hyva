<?php
/**
 * Sorter: Metalio
 * - < sm: pill select (do bottom-sheetu)
 * - ≥ sm: horizontálne tabs (oddelenie obsahu od produktov)
 * Pozn.: bez ASC/DESC toggle – poradie je riešené cez vlastné options (Najlacnejšie, Najdrahšie, ...)
 */

declare(strict_types=1);

use Magento\Catalog\Block\Product\ProductList\Toolbar;

/** @var Toolbar $block */

$orders       = (array) $block->getAvailableOrders();
$currentOrder = (string) ($block->getCurrentOrder() ?: $block->getDefaultOrder());
$currentDir   = strtolower((string) ($block->getCurrentDirection() ?: ($block->getDefaultDirection() ?: 'asc')));

$pagerUrl = function (string $code) use ($block, $currentDir): string {
    return (string) $block->getPagerUrl([
        'product_list_order' => $code,
        'product_list_dir'   => $currentDir, // nechávame tak, ale už to používateľ nerieši
    ]);
};
?>

<?php if ($orders): ?>

  <!-- MOBILE: pill select -->
  <div class="sm:hidden w-full">
    <div class="relative">
      <select
        class="w-full appearance-none min-h-[48px]
               rounded-full bg-gray-100 hover:bg-gray-200 transition-colors
               border border-transparent focus:border-slate-300 focus:ring-2 focus:ring-slate-200
               pl-4 pr-12 text-[15px] font-semibold text-slate-800"
        style="-webkit-appearance:none; -moz-appearance:none; appearance:none; background-image:none;"
        onchange="if(this.value){ location.href=this.value; }"
        aria-label="<?= $block->escapeHtmlAttr(__('Zoradiť podľa')) ?>"
      >
        <?php foreach ($orders as $code => $label): ?>
          <?php $code = (string) $code; ?>
          <option value="<?= $block->escapeUrl($pagerUrl($code)) ?>"
            <?= $currentOrder === $code ? 'selected' : '' ?>>
            <?= $block->escapeHtml(__($label)) ?>
          </option>
        <?php endforeach; ?>
      </select>

      <span class="pointer-events-none absolute right-4 top-1/2 -translate-y-1/2 text-slate-600">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
             stroke-width="2" stroke="currentColor" class="h-5 w-5" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
      </span>
    </div>
  </div>

  <!-- DESKTOP/TABLET: čisté tabs (oddelenie od produktov) -->
  <div class="hidden sm:block">
    <ul class="flex items-center gap-6 lg:gap-8 overflow-x-auto scrollbar-none"
        style="-ms-overflow-style:none; scrollbar-width:none;">
      <?php foreach ($orders as $code => $label): ?>
        <?php
          $code = (string) $code;
          $isActive = ($currentOrder === $code);
          $url = $pagerUrl($code);
        ?>
        <li class="shrink-0">
          <a href="<?= $block->escapeUrl($url) ?>"
             class="relative inline-flex items-center py-2 text-[15px] transition-colors
                    <?= $isActive ? 'text-slate-900 font-semibold' : 'text-slate-600 hover:text-slate-900' ?>"
             aria-current="<?= $isActive ? 'true' : 'false' ?>">
            <?= $block->escapeHtml(__($label)) ?>

            <?php if ($isActive): ?>
              <span class="absolute left-0 right-0 -bottom-[2px] h-[2px] bg-primary rounded-full"></span>
            <?php endif; ?>
          </a>
        </li>
      <?php endforeach; ?>
    </ul>
  </div>

<?php endif; ?>
