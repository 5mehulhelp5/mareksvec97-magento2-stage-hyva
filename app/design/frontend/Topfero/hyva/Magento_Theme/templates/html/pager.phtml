<?php
/**
 * Hyvä Themes – Pager (Topfero / Figma Make style) – uses Tailwind theme tokens (primary/secondary/border/text)
 */

use Hyva\Theme\Model\LocaleFormatter;
use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsSolid;
use Magento\Framework\Escaper;
use Magento\Theme\Block\Html\Pager;

/** @var Pager $block */
/** @var Escaper $escaper */
/** @var LocaleFormatter $localeFormatter */
/** @var ViewModelRegistry $viewModels */
/** @var HeroiconsSolid $heroicons */

$heroicons = $viewModels->require(HeroiconsSolid::class);

$paginationUrlAnchor = $block->hasData('pagination_url_anchor')
    ? '#' . $escaper->escapeHtmlAttr((string) $block->getData('pagination_url_anchor'))
    : '';

$iconSize = 20;

// Wrapper (matches your React layout)
$wrapperClass = 'flex items-center justify-center gap-2 mt-8';

// Prev/Next buttons (token-based)
$iconBtnBase = 'p-2 rounded-lg border transition-colors inline-flex items-center justify-center';
$iconBtnEnabled = 'border-border text-text hover:bg-secondary-lighter';
$iconBtnDisabled = 'border-border-lighter text-muted cursor-not-allowed pointer-events-none';

// Page buttons (token-based)
$pageBtnBase = 'min-w-[40px] h-[40px] rounded-lg font-medium transition-all inline-flex items-center justify-center';
$pageBtnInactive = 'bg-secondary text-text hover:bg-secondary-darker';
$pageBtnActive = 'bg-primary text-white shadow-md';

// Ellipsis
$ellipsisClass = 'px-2 text-muted select-none';

?>
<?php if ($block->getCollection()->getSize()): ?>
    <?php if ($block->getLastPageNum() > 1): ?>
        <nav class="<?= $wrapperClass ?>" aria-label="pagination">
            <?php
                $previousLabel = $block->getAnchorTextForPrevious() ?: __('Previous Page');
                $nextLabel = $block->getAnchorTextForNext() ?: __('Next Page');
            ?>

            <!-- Prev -->
            <a
                href="<?= $escaper->escapeUrl($block->getPreviousPageUrl()) . /* @noEscape */ $paginationUrlAnchor ?>"
                class="<?= $iconBtnBase ?> <?= $block->isFirstPage() ? $iconBtnDisabled : $iconBtnEnabled ?> pages-item-previous"
                aria-label="<?= $escaper->escapeHtmlAttr($previousLabel) ?>"
                <?= $block->isFirstPage() ? 'aria-disabled="true" tabindex="-1"' : '' ?>
                rel="prev"
            >
                <?= $heroicons->chevronLeftHtml('w-5 h-5', $iconSize, $iconSize, ['aria-hidden' => 'true']); ?>
            </a>

            <!-- Pages -->
            <div class="flex items-center gap-2">
                <?php if ($block->canShowFirst()): ?>
                    <a
                        href="<?= $escaper->escapeUrl($block->getFirstPageUrl()) . /* @noEscape */ $paginationUrlAnchor ?>"
                        class="<?= $pageBtnBase ?> <?= $pageBtnInactive ?>"
                        aria-label="<?= $escaper->escapeHtml(__('Page') . ' 1') ?>"
                    ><?= $escaper->escapeHtml($localeFormatter->formatNumber(1)) ?></a>
                <?php endif; ?>

                <?php if ($block->canShowPreviousJump()): ?>
                    <span class="<?= $ellipsisClass ?>">…</span>
                <?php endif; ?>

                <?php foreach ($block->getFramePages() as $page): ?>
                    <?php if ($block->isPageCurrent($page)): ?>
                        <span
                            class="<?= $pageBtnBase ?> <?= $pageBtnActive ?>"
                            aria-current="page"
                            aria-label="<?= $escaper->escapeHtml(__('You\'re currently reading page')) ?>"
                        ><?= $escaper->escapeHtml($localeFormatter->formatNumber($page)) ?></span>
                    <?php else: ?>
                        <a
                            href="<?= $escaper->escapeUrl($block->getPageUrl($page)) . /* @noEscape */ $paginationUrlAnchor ?>"
                            class="<?= $pageBtnBase ?> <?= $pageBtnInactive ?>"
                            aria-label="<?= $escaper->escapeHtml(__('Page') . ' ' . $localeFormatter->formatNumber($page)) ?>"
                        ><?= $escaper->escapeHtml($localeFormatter->formatNumber($page)) ?></a>
                    <?php endif; ?>
                <?php endforeach; ?>

                <?php if ($block->canShowNextJump()): ?>
                    <span class="<?= $ellipsisClass ?>">…</span>
                <?php endif; ?>

                <?php if ($block->canShowLast()): ?>
                    <a
                        href="<?= $escaper->escapeUrl($block->getLastPageUrl()) . /* @noEscape */ $paginationUrlAnchor ?>"
                        class="<?= $pageBtnBase ?> <?= $pageBtnInactive ?>"
                        aria-label="<?= $escaper->escapeHtml(__('Page') . ' ' . $localeFormatter->formatNumber($block->getLastPageNum())) ?>"
                    ><?= $escaper->escapeHtml($localeFormatter->formatNumber($block->getLastPageNum())) ?></a>
                <?php endif; ?>
            </div>

            <!-- Next -->
            <a
                href="<?= $escaper->escapeUrl($block->getNextPageUrl()) . /* @noEscape */ $paginationUrlAnchor ?>"
                class="<?= $iconBtnBase ?> <?= $block->isLastPage() ? $iconBtnDisabled : $iconBtnEnabled ?> pages-item-next"
                aria-label="<?= $escaper->escapeHtmlAttr($nextLabel) ?>"
                <?= $block->isLastPage() ? 'aria-disabled="true" tabindex="-1"' : '' ?>
                rel="next"
            >
                <?= $heroicons->chevronRightHtml('w-5 h-5', $iconSize, $iconSize, ['aria-hidden' => 'true']); ?>
            </a>
        </nav>
    <?php endif; ?>
<?php endif; ?>
