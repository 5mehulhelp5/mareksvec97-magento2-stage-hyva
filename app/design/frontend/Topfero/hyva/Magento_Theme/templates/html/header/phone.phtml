<?php
/** @var \Magento\Framework\Escaper $escaper */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Hyva\Theme\ViewModel\HeroiconsOutline;
use Hyva\Theme\ViewModel\HeroiconsSolid;

/** ---- ViewModels najprv registry, potom require ---- */


$heroicons = $viewModels->require(HeroiconsOutline::class);

/** @var HeroiconsSolid $heroiconsSolid */
$heroiconsSolid = $viewModels->require(HeroiconsSolid::class);

/** ---- Ikona telefónu: solid -> outline -> inline SVG fallback ---- */


/** ---- Nastavenia ---- */
$phoneNumber   = $block->getData('phone_number') ?: '+421 910 123 456';
$telHref       = preg_replace('/\s+/', '', $phoneNumber); // "tel:+421910123456"
$startHour     = 9;
$endHour       = 16;
$currentHour   = (int) date('G'); // server time; prípadne si môžeš nahradiť store time
$isOpen        = ($currentHour >= $startHour && $currentHour < $endHour);
$dotClass      = $isOpen ? 'bg-green-500' : 'bg-red-500';
$dotLabel      = $isOpen ? __('K dispozícii') : __('Mimo pracovnej doby');
?>
<div class="flex items-center gap-2">
    <!-- Mobil: okrúhla ikonka -->
    <a href="tel:<?= $escaper->escapeHtmlAttr($telHref) ?>"
       class="inline-flex md:hidden items-center justify-center w-10 h-10 min-w-[48px] min-h-[48px] rounded-full bg-gray-100 hover:bg-gray-200 transition-colors relative text-slate-800"
       aria-label="<?= $escaper->escapeHtmlAttr(__('Zavolať')) ?>"
       title="<?= $escaper->escapeHtmlAttr(__('Zavolať')) ?>">
        <span class="relative inline-flex">
            <?= $heroicons->phoneHtml('', 24, 24, ["aria-hidden" => "true"]) ?>
            <span class="absolute -top-1 -right-1 w-3 h-3 rounded-full <?= $dotClass ?>"
                  title="<?= $escaper->escapeHtmlAttr($dotLabel) ?>"></span>
        </span>
    </a>

    <!-- Tablet/desktop: pill s výškou 48px, zarovnanie ako customer/cart -->
    <a href="tel:<?= $escaper->escapeHtmlAttr($telHref) ?>"
       class="hidden md:inline-flex items-center md:h-[48px] min-w-[48px] min-h-[48px] h-full gap-2 bg-gray-100 px-3 rounded-full hover:bg-gray-200 transition-colors relative text-slate-800">
        <span class="relative inline-flex">
            <?= $heroicons->phoneHtml('', 24, 24, ["aria-hidden" => "true"]) ?>
            <span class="absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full <?= $dotClass ?>"
                  title="<?= $escaper->escapeHtmlAttr($dotLabel) ?>"></span>
        </span>
        <span class="text-sm font-semibold whitespace-nowrap"><?= $escaper->escapeHtml($phoneNumber) ?></span>
    </a>
</div>
