<?php
declare(strict_types=1);

/** @var \Hyva\Theme\Model\ViewModelRegistry $viewModels */
/** @var \Magento\Framework\View\Element\Template $block */

use Hyva\Theme\ViewModel\HeroiconsOutline;
use Magento\Store\Model\ScopeInterface;

$heroIcons = $viewModels->require(HeroiconsOutline::class);

$scopeConfig = \Magento\Framework\App\ObjectManager::getInstance()
    ->get(\Magento\Framework\App\Config\ScopeConfigInterface::class);

$iconMap = [
    'shield' => 'shieldCheckHtml',
    'globe'  => 'globeAltHtml',
    'badge'  => 'badgeCheckHtml',
    'thumb'  => 'thumbUpHtml',
    'phone'  => 'phoneHtml',
];

$defs = [];
for ($i = 1; $i <= 5; $i++) {
    $icon  = (string) ($scopeConfig->getValue("metalio/store_benefits/b{$i}_icon",  ScopeInterface::SCOPE_STORE) ?? '');
    $title = (string) ($scopeConfig->getValue("metalio/store_benefits/b{$i}_title", ScopeInterface::SCOPE_STORE) ?? '');
    $text  = (string) ($scopeConfig->getValue("metalio/store_benefits/b{$i}_text",  ScopeInterface::SCOPE_STORE) ?? '');

    if (trim($title) !== '' || trim($text) !== '') {
        $defs[] = [
            'icon'  => strtolower(trim($icon)),
            'title' => $title,
            'text'  => $text,
        ];
    }
}

if (!$defs) {
    return;
}
?>

<!-- FULL-WIDTH breakout (funguje aj keÄ parent je .container / max-width) -->
<div class="relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] w-screen">
    <div class="py-12 border-y bg-primary border-primary-darker">
        <div class="max-w-7xl mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <?php foreach ($defs as $def): ?>
                    <?php
                    $method = $iconMap[$def['icon']] ?? 'badgeCheckHtml';
                    if (!method_exists($heroIcons, $method)) {
                        $method = 'badgeCheckHtml';
                    }
                    ?>
                    <div class="flex flex-col items-center text-center gap-3">
                        <div class="w-16 h-16 rounded-full flex items-center justify-center bg-white">
                            <?= /* @noEscape */ $heroIcons->{$method}('w-8 h-8 text-primary') ?>
                        </div>

                        <?php if (trim((string)$def['title']) !== ''): ?>
                            <h3 class="font-bold !text-lg text-white">
                                <?= $block->escapeHtml($def['title']) ?>
                            </h3>
                        <?php endif; ?>

                        <?php if (trim((string)$def['text']) !== ''): ?>
                            <p class="text-sm text-white leading-relaxed opacity-90">
                                <?= $block->escapeHtml($def['text']) ?>
                            </p>
                        <?php endif; ?>
                    </div>
                <?php endforeach; ?>
            </div>
        </div>
    </div>
</div>
