<section
  class="reviews-block container mx-auto px-4 py-10"
  x-data="reviewsSlider()"
  x-init="init()"
>
  <!-- Hlava -->
  <h2 class="text-2xl md:text-3xl font-semibold text-primary mb-6">
    Hodnotenia zákazníkov
  </h2>

  <!-- Súhrn -->
  <div class="review summary flex items-center gap-4 bg-white border border-container-DEFAULT rounded-xl p-5 mb-6">
    <span class="review-stars big flex">
      <template x-for="i in 5" :key="i">
        <svg class="w-6 h-6 fill-yellow-400" viewBox="0 0 20 20" aria-hidden="true">
          <path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/>
        </svg>
      </template>
    </span>
    <span class="review-rating text-xl font-bold" aria-label="Priemerné hodnotenie">4,68</span>
    <p class="review-text-bold text-slate-700">Super</p>
  </div>

  <!-- Slider ovládanie -->
  <div class="flex items-center justify-between mb-3">
    <div class="flex items-center gap-2">
      <button
        type="button"
        class="btn btn-secondary btn-size-sm disabled:opacity-50"
        :disabled="isFirst"
        @click="prev()"
        aria-label="Predchádzajúca"
      >
        Predchádzajúca
      </button>
      <button
        type="button"
        class="btn btn-secondary btn-size-sm disabled:opacity-50"
        :disabled="isLast"
        @click="next()"
        aria-label="Nasledujúca"
      >
        Nasledujúca
      </button>
    </div>

    <!-- Bodky -->
    <ul class="flex items-center gap-2" role="tablist" aria-label="Posun v recenziách">
      <template x-for="n in pages" :key="n">
        <li role="tab">
          <button
            type="button"
            class="w-2.5 h-2.5 rounded-full"
            :class="currentPage === (n-1) ? 'bg-primary' : 'bg-slate-300'"
            @click="goTo(n-1)"
            :aria-label="`${n}/${pages}`"
          ></button>
        </li>
      </template>
    </ul>
  </div>

  <!-- Track + karty -->
  <div class="relative">
    <div
      class="overflow-hidden"
      x-ref="viewport"
    >
      <div
        x-ref="track"
        class="flex gap-4 md:gap-6 will-change-transform scroll-smooth"
        style="scroll-snap-type: x mandatory;"
      >
        <!-- Každá karta: basis podľa perView -->
        <!-- 1) 3.1.2025 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 5" :key="`a-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
              </span>
              <time class="text-sm text-slate-500">3.1.2025</time>
            </div>
            <p class="text-slate-700">
              Objednal som si kovové popisné číslo pre náš dom a výsledok je úžasný! Materiál je pevný a dizajn presne podľa predstáv. Dodanie bolo rýchle a bezpečne zabalené. Určite odporúčam Metalio každému, kto hľadá kvalitné kovové produkty.
            </p>
          </div>
        </article>

        <!-- 2) 12.12.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 5" :key="`b-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
              </span>
              <time class="text-sm text-slate-500">12.12.2024</time>
            </div>
            <p class="text-slate-700">
              Krásna kovová dekorácia, presne podľa očakávaní. Rýchle dodanie!
            </p>
          </div>
        </article>

        <!-- 3) 3.11.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 5" :key="`c-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
              </span>
              <time class="text-sm text-slate-500">3.11.2024</time>
            </div>
            <p class="text-slate-700">
              Kovová dekorácia na stenu, ktorú som si zakúpila, dodala našej obývačke moderný vzhľad. Oceňujem profesionálny prístup a rýchlu odozvu na moje otázky.
            </p>
          </div>
        </article>

        <!-- 4) 29.8.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <!-- 4 hviezdy -->
                <template x-for="i in 4" :key="`d-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
                <svg class="w-5 h-5 fill-slate-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
              </span>
              <time class="text-sm text-slate-500">29.8.2024</time>
            </div>
            <p class="text-slate-700">
              Dobrý produkt, no doručenie trvalo trochu dlhšie.
            </p>
          </div>
        </article>

        <!-- 5) 28.6.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 4" :key="`e-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
                <svg class="w-5 h-5 fill-slate-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
              </span>
              <time class="text-sm text-slate-500">28.6.2024</time>
            </div>
            <p class="text-slate-700">
              Metalio mi pomohlo s výrobou jedinečného laserového dizajnu na mieru…
            </p>
          </div>
        </article>

        <!-- 6) 5.5.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 4" :key="`f-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
                <svg class="w-5 h-5 fill-slate-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
              </span>
              <time class="text-sm text-slate-500">5.5.2024</time>
            </div>
            <p class="text-slate-700">
              Zakúpila som si kovovú dekoráciu s geometrickým vzorom. Kvalita je výborná…
            </p>
          </div>
        </article>

        <!-- 7) 24.4.2024 -->
        <article class="shrink-0 basis-full lg:basis-1/3 scroll-ml-4 md:scroll-ml-6" style="scroll-snap-align: start;">
          <div class="h-full bg-white border border-container-DEFAULT rounded-xl p-5">
            <div class="flex items-center justify-between mb-2">
              <span class="flex">
                <template x-for="i in 4" :key="`g-${i}`">
                  <svg class="w-5 h-5 fill-yellow-400" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
                </template>
                <svg class="w-5 h-5 fill-slate-300" viewBox="0 0 20 20"><path d="M10 15l-5.878 3.09L5.82 11.545.94 7.41l6.09-.885L10 1l2.97 5.525 6.09.885-4.88 4.135 1.698 6.545z"/></svg>
              </span>
              <time class="text-sm text-slate-500">24.4.2024</time>
            </div>
            <p class="text-slate-700">
              Objednávka prišla rýchlo a bola presne podľa popisu. Ďakujem!
            </p>
          </div>
        </article>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('reviewsSlider', () => ({
      currentPage: 0,
      pages: 1,
      perView: 1,
      isFirst: true,
      isLast: false,
      init() {
        this.$nextTick(() => {
          this.recalculate();
          window.addEventListener('resize', this.recalculate.bind(this));
          this.syncButtons();
        });
      },
      recalculate() {
        // perView: 1 na <1024px, inak 3
        this.perView = window.innerWidth >= 1024 ? 3 : 1;
        const items = this.$refs.track.children.length;
        this.pages = Math.max(1, Math.ceil(items / this.perView));
        this.currentPage = Math.min(this.currentPage, this.pages - 1);
        this.scrollToPage(this.currentPage, false);
      },
      scrollToPage(page, smooth = true) {
        const viewport = this.$refs.viewport;
        const behavior = smooth ? 'smooth' : 'auto';
        viewport.scrollTo({ left: page * viewport.clientWidth, behavior });
        this.currentPage = page;
        this.syncButtons();
      },
      next() {
        if (this.currentPage < this.pages - 1) {
          this.scrollToPage(this.currentPage + 1);
        }
      },
      prev() {
        if (this.currentPage > 0) {
          this.scrollToPage(this.currentPage - 1);
        }
      },
      goTo(page) {
        this.scrollToPage(page);
      },
      syncButtons() {
        this.isFirst = this.currentPage === 0;
        this.isLast = this.currentPage === this.pages - 1;
      }
    }))
  })
</script>
