<?php
/**
 * Metalio / Hyvä - Viewmode switcher (jednotný dizajn ako minicart/menu)
 * - Mobile: segment control (pill)
 * - Desktop: kompaktný pill s ikonami (bez inline <style> a bez border boxu)
 */

declare(strict_types=1);

use Hyva\Theme\Model\ViewModelRegistry;
use Magento\Catalog\Block\Product\ProductList\Toolbar;
use Magento\Framework\Escaper;

/** @var Toolbar $block */
/** @var Escaper $escaper */
/** @var ViewModelRegistry $viewModels */
?>

<?php if ($block->isEnabledViewSwitcher()): ?>
  <?php $modes = (array) $block->getModes(); ?>
  <?php if ($modes && count($modes) > 1): ?>

    <nav class="modes w-full"
         aria-label="<?= $escaper->escapeHtmlAttr(__('Products view mode')) ?>">

      <!-- MOBILE: segment control -->
      <div class="sm:hidden">
        <div class="flex rounded-full bg-gray-100 p-1">
          <?php foreach ($modes as $code => $label): ?>
            <?php
              $modeCode = strtolower((string) $code);
              $isActive = (bool) $block->isModeActive($code);
            ?>
            <button
              type="button"
              class="flex-1 inline-flex items-center justify-center gap-2 min-h-[44px]
                     rounded-full text-[14px] font-semibold transition-colors
                     <?= $isActive ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-700 hover:text-slate-900' ?>"
              title="<?= $escaper->escapeHtmlAttr($label) ?>"
              <?= $isActive ? 'disabled' : '@click.prevent="changeListMode"' ?>
              data-list-mode="<?= $escaper->escapeHtmlAttr($modeCode) ?>"
              data-role="mode-switcher"
              data-value="<?= $escaper->escapeHtmlAttr($modeCode) ?>"
              aria-label="<?= $escaper->escapeHtmlAttr(__('Products view mode - %1', $label)) ?>"
            >
              <?php if ($modeCode === 'grid'): ?>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="2" stroke="currentColor" class="h-5 w-5" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
              <?php else: ?>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="2" stroke="currentColor" class="h-5 w-5" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
              <?php endif; ?>

              <span><?= $escaper->escapeHtml(__($label)) ?></span>
            </button>
          <?php endforeach; ?>
        </div>
      </div>

      <!-- DESKTOP: kompaktný pill (ikonky) -->
      <div class="hidden sm:flex">
        <div class="inline-flex rounded-full bg-gray-100 p-1">
          <?php foreach ($modes as $code => $label): ?>
            <?php
              $modeCode = strtolower((string) $code);
              $isActive = (bool) $block->isModeActive($code);
            ?>
            <button
              type="button"
              class="inline-flex items-center justify-center min-w-[44px] min-h-[44px]
                     rounded-full transition-colors
                     <?= $isActive ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-700 hover:text-slate-900' ?>"
              title="<?= $escaper->escapeHtmlAttr($label) ?>"
              <?= $isActive ? 'disabled' : '@click.prevent="changeListMode"' ?>
              data-list-mode="<?= $escaper->escapeHtmlAttr($modeCode) ?>"
              data-role="mode-switcher"
              data-value="<?= $escaper->escapeHtmlAttr($modeCode) ?>"
              aria-label="<?= $escaper->escapeHtmlAttr(__('Products view mode - %1', $label)) ?>"
            >
              <?php if ($modeCode === 'grid'): ?>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="2" stroke="currentColor" class="h-5 w-5" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                </svg>
              <?php else: ?>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                     stroke-width="2" stroke="currentColor" class="h-5 w-5" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round"
                        d="M4 6h16M4 10h16M4 14h16M4 18h16" />
                </svg>
              <?php endif; ?>
            </button>
          <?php endforeach; ?>
        </div>
      </div>

    </nav>

  <?php endif; ?>
<?php endif; ?>
