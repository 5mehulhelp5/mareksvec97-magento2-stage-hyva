<?php
/** @var \Magento\Framework\View\Element\Template $block */

use Magento\Store\Model\ScopeInterface;
use Magento\Framework\UrlInterface;

$om           = \Magento\Framework\App\ObjectManager::getInstance();
/** @var \Magento\Framework\App\Config\ScopeConfigInterface $cfg */
$cfg          = $om->get(\Magento\Framework\App\Config\ScopeConfigInterface::class);
/** @var \Magento\Store\Model\StoreManagerInterface $storeManager */
$storeManager = $om->get(\Magento\Store\Model\StoreManagerInterface::class);

$basePath = 'metalio_homepage/cta/';
$enabled  = (bool) $cfg->getValue($basePath.'enabled', ScopeInterface::SCOPE_STORE);
if (!$enabled) return;

$title    = (string) ($cfg->getValue($basePath.'title',     ScopeInterface::SCOPE_STORE) ?: __('Potrebujete vypáliť niečo na mieru?'));
$textHtml = (string)  $cfg->getValue($basePath.'text_html', ScopeInterface::SCOPE_STORE);
$ctaLabel = (string) ($cfg->getValue($basePath.'cta_label', ScopeInterface::SCOPE_STORE) ?: __('Kontaktovať'));
$ctaUrl   = (string) ($cfg->getValue($basePath.'cta_url',   ScopeInterface::SCOPE_STORE) ?: '#');

$benefitsRaw = (string) $cfg->getValue($basePath.'benefits', ScopeInterface::SCOPE_STORE);
$benefits    = array_values(array_filter(array_map(static function ($line) {
    $t = trim(preg_replace('/\s+/u', ' ', str_replace(["\xc2\xa0", '&nbsp;'], ' ', (string) $line)));
    return $t !== '' ? $t : null;
}, preg_split('/\R/u', $benefitsRaw))));

// obrázok (môže byť relatívna cesta z uploadu alebo plná URL)

$caption= (string)  $cfg->getValue($basePath.'photo_caption', ScopeInterface::SCOPE_STORE);

;
?>

<section class="relative mb-12">
  <div class="mx-auto">
    <div class="relative overflow-hidden rounded-2xl bg-primary text-white shadow-xl ring-1 ring-black/5">

      <!-- jemný halo gradient vpravo -->
      <div class="pointer-events-none absolute inset-y-0 right-0 w-1/2">
        <div class="absolute right-[-10%] top-1/2 h-[520px] w-[520px] -translate-y-1/2 rounded-full bg-white/10 blur-3xl"></div>
      </div>

      <div class="grid grid-cols-1 items-center gap-10 px-6 py-10 sm:px-10 lg:grid-cols-[65%_35%]">

        <!-- Text -->
        <div>
          <h3 class="text-3xl sm:text-3xl font-extrabold leading-tight">
            <?= $block->escapeHtml($title) ?>
          </h3>
          <div class="mt-3 h-[3px] w-14 rounded bg-white/80"></div>

          <?php if ($textHtml): ?>
            <div class="mt-5 text-white/90 prose prose-invert max-w-none">
              <?= /* @noEscape */ $textHtml ?>
            </div>
          <?php endif; ?>

          <?php if (!empty($benefits)): ?>
            <ul class="mt-6 flex flex-wrap gap-2">
              <?php foreach ($benefits as $b): ?>
                <li class="inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1.5 text-sm ring-1 ring-white/20">
                  <!-- ikonka check -->
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  <?= $block->escapeHtml($b) ?>
                </li>
              <?php endforeach; ?>
            </ul>
          <?php endif; ?>

          <?php if ($ctaUrl && $ctaUrl !== '#'): ?>
            <a href="<?= $block->escapeUrl($ctaUrl) ?>"
               class="inline-flex items-center gap-2 mt-7 rounded-md bg-white px-5 py-3 font-semibold text-primary shadow-sm
                      ring-1 ring-white/20 transition hover:bg-white/90 focus:outline-none focus-visible:ring-2 focus-visible:ring-white/60 group">
              <?= $block->escapeHtml($ctaLabel) ?>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                   stroke-width="2" stroke="currentColor" class="h-5 w-5 transition-transform group-hover:translate-x-1">
                <path stroke-linecap="round" stroke-linejoin="round" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
              </svg>
            </a>
          <?php endif; ?>
        </div>

        <!-- Foto -->
    
          <div class="relative flex justify-center">
            <figure class="relative -mr-0 lg:-mr-6">
              <div class="absolute inset-0 rounded-full bg-white/5 backdrop-blur-sm ring-1 ring-white/20"></div>
              <img
                src="<?= $this->getViewFileUrl('Magento_Contact::images/metalio-user.png'); ?>"
                alt="avatar metalio"
                class="relative h-40 w-40 sm:h-48 sm:w-48 lg:h-60 lg:w-60 rounded-full object-cover shadow-2xl ring-1 ring-black/10"
                loading="lazy" decoding="async"
              />
              <?php if ($caption): ?>
                <figcaption class="absolute -bottom-3 left-1/2 -translate-x-1/2 whitespace-nowrap rounded-full bg-black/30 px-3 py-1 text-xs backdrop-blur-md ring-1 ring-white/20">
                  <?= $block->escapeHtml($caption) ?>
                </figcaption>
              <?php endif; ?>
            </figure>
          </div>
    

      </div>

    </div>
  </div>
</section>
