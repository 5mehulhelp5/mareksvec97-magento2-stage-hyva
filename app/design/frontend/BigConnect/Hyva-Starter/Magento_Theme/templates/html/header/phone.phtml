<?php
/** @var \Magento\Framework\Escaper $escaper */

declare(strict_types=1);

use Hyva\Theme\ViewModel\HeroiconsOutline;
use Hyva\Theme\ViewModel\HeroiconsSolid;

$heroicons = $viewModels->require(HeroiconsOutline::class);
/** @var HeroiconsSolid $heroiconsSolid */
$heroiconsSolid = $viewModels->require(HeroiconsSolid::class);

/** ---- Nastavenia ---- */
$phoneNumber = $block->getData('phone_number') ?: '+421 910 123 456';
$telHref     = preg_replace('/\s+/', '', $phoneNumber);

$startHour   = 9;
$endHour     = 16;
$currentHour = (int) date('G');
$isOpen      = ($currentHour >= $startHour && $currentHour < $endHour);

$dotClass = $isOpen ? 'bg-green-500' : 'bg-red-500';
$dotLabel = $isOpen ? __('K dispozícii') : __('Mimo pracovnej doby');
?>

<div class="flex items-center gap-2">
    <!-- Mobil: chip 38x38 -->
    <a href="tel:<?= $escaper->escapeHtmlAttr($telHref) ?>"
       class="inline-flex md:hidden items-center justify-center
              h-[38px] w-[38px] min-w-[38px] min-h-[38px]
              rounded-lg hover:bg-gray-50 transition-colors border border-gray-200"
       aria-label="<?= $escaper->escapeHtmlAttr(__('Zavolať')) ?>"
       title="<?= $escaper->escapeHtmlAttr(__('Zavolať')) ?>"
    >
        <span class="relative inline-flex">
            <?= $heroicons->phoneHtml('', 22, 22, ['aria-hidden' => 'true']) ?>
            <span class="absolute -top-1 -right-1 w-3 h-3 rounded-full <?= $dotClass ?>"
                  title="<?= $escaper->escapeHtmlAttr($dotLabel) ?>"></span>
        </span>
    </a>

    <!-- Tablet/desktop: chip 38px s číslom -->
    <a href="tel:<?= $escaper->escapeHtmlAttr($telHref) ?>"
       class="hidden md:inline-flex items-center gap-2
              h-[38px] min-h-[38px] min-w-[38px]
              px-3 rounded-lg hover:bg-gray-50 transition-colors border border-gray-200"
    >
        <span class="relative inline-flex">
            <?= $heroicons->phoneHtml('', 22, 22, ['aria-hidden' => 'true']) ?>
            <span class="absolute -top-1 -right-1 w-2.5 h-2.5 rounded-full <?= $dotClass ?>"
                  title="<?= $escaper->escapeHtmlAttr($dotLabel) ?>"></span>
        </span>

        <span class="text-sm font-semibold whitespace-nowrap">
            <?= $escaper->escapeHtml($phoneNumber) ?>
        </span>
    </a>
</div>
